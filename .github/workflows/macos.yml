name: go-macos

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]

permissions:
  contents: read

#jobs:
#  test:
#    uses: cloudengio/.github/.github/workflows/go-test-multimod.yml@main
#    with:
#      os-version: macos-latest
#      go-versions: |
#        [ "1.25.x" ]

jobs:
  test:
    runs-on: macos-latest

    steps:
      - uses: actions/checkout@v5
      - uses: cloudengio/.github/.github/actions/go@main
      - uses: cloudengio/.github/.github/actions/pebble@main
      - uses: cloudengio/.github/.github/actions/chrome@main
        id: setup-chrome
      - uses: cloudengio/.github/.github/actions/mkcert@main

      - name: test
        env:
          CHROME_BIN_PATH: ${{ steps.setup-chrome.outputs.chrome-path }}
          CHROME_USER_DATA_DIR: ${{ steps.setup-chrome.outputs.chrome-user-data-dir }}
        run: |
          cd webapp
          go test -v -race --timeout=2m ./...
